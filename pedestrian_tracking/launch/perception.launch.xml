<launch>

    <arg name="zed_x_offset" default="-0.2" description="Offset from base link of robot to zed camera (m)"/>
    <arg name="sim_ped" default="false" description="Simulate pedestrian data. Options: true, false"/>

    <!-- Start streaming from ZED if not simulating -->
    <include file="$(find-pkg-share pedestrian_tracking)/launch/zed.launch.xml" 
             if="$(eval '\'$(var sim_ped)\' == \'false\'')">
    </include>

    <!-- convert zed object message to pedestrian type & transform frames -->
    <node pkg="pedestrian_tracking" exec="convert_zed_ped"
          if="$(eval '\'$(var sim_ped)\' == \'false\'')">
    </node>

    <!-- Add transform from odom to base link of the robot. offset is only in x direction -->
    <node pkg="tf2_ros" exec="static_transform_publisher" 
          args="--frame-id odom
              --child-frame-id base_link
              --x $(var zed_x_offset)
              --y 0
              --z 0
              --roll 0
              --pitch 0
              --yaw 0" 
          if="$(eval '\'$(var sim_ped)\' == \'false\'')">
    </node>

    <!-- Create the BRNE frame as a child of odom, at same location as base_link -->
    <node pkg="tf2_ros" exec="static_transform_publisher" 
          args="--frame-id odom
              --child-frame-id brne
              --x $(var zed_x_offset)
              --y 0
              --z 0
              --roll 0
              --pitch 0
              --yaw 0" >
    </node>

    <!-- launch simulated pedestrian node if simulating -->
    <node pkg="pedestrian_tracking" exec="simulate_pedestrians" 
          if="$(eval '\'$(var sim_ped)\' == \'true\'')">
    </node>

    <!-- publish pedestrian markers regardless -->
    <node pkg="pedestrian_tracking" exec="show_pedestrians">
    </node>

</launch>
